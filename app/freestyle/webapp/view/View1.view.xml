<mvc:View controllerName="freestyle.controller.View1"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core">
    
    <Page id="page" title="Purchase Requisitions Management" showNavButton="false">
        <content>
            <!-- Filter Bar -->
            <VBox class="sapUiMediumMargin">
                <Panel headerText="Filters" expandable="true" expanded="false">
                    <content>
                        <HBox class="sapUiMediumMargin">
                            <VBox class="sapUiMediumMarginEnd">
                                <Label text="Material:" />
                                <Input id="materialFilter" placeholder="Enter material..." width="200px" />
                            </VBox>
                            <VBox class="sapUiMediumMarginEnd">
                                <Label text="Plant:" />
                                <Input id="plantFilter" placeholder="Enter plant..." width="150px" />
                            </VBox>
                            <VBox class="sapUiMediumMarginEnd">
                                <Label text="Status:" />
                                <ComboBox id="statusFilter" width="150px">
                                    <core:Item key="" text="All" />
                                    <core:Item key="OPEN" text="Open" />
                                    <core:Item key="RELEASED" text="Released" />
                                    <core:Item key="CLOSED" text="Closed" />
                                </ComboBox>
                            </VBox>
                            <VBox class="sapUiMediumMarginEnd">
                                <Label text="Date From:" />
                                <DatePicker id="dateFromFilter" width="150px" />
                            </VBox>
                            <VBox class="sapUiMediumMarginEnd">
                                <Label text="Date To:" />
                                <DatePicker id="dateToFilter" width="150px" />
                            </VBox>
                            <VBox class="sapUiMediumMarginTop">
                                <HBox>
                                    <Button text="Apply Filters" press="onApplyFilters" type="Emphasized" class="sapUiTinyMarginEnd" />
                                    <Button text="Clear Filters" press="onClearFilters" />
                                </HBox>
                            </VBox>
                        </HBox>
                    </content>
                </Panel>
            </VBox>

            <!-- Toolbar with Actions -->
            <Toolbar>
                <Title text="Purchase Requisitions ({/count})" />
                <ToolbarSpacer />
                <Button text="Create" icon="sap-icon://add" press="onCreate" type="Emphasized" />
                <Button text="Export" icon="sap-icon://excel-attachment" press="onExport" />
                <Button text="Refresh" icon="sap-icon://refresh" press="onRefresh" />
            </Toolbar>

            <!-- Main Table -->
            <Table id="purchaseRequisitionTable" 
                   items="{path: '/PurchaseRequisition', sorter: {path: 'createdAt', descending: true}}"
                   growing="true"
                   growingThreshold="50"
                   mode="SingleSelect"
                   class="sapUiResponsiveMargin">
                
                <headerToolbar>
                    <Toolbar>
                        <Title text="Items" />
                        <ToolbarSpacer />
                        <Button icon="sap-icon://sort" press="onSort" tooltip="Sort Options" />
                        <Button icon="sap-icon://action-settings" press="onTableSettings" tooltip="Table Settings" />
                    </Toolbar>
                </headerToolbar>

                <columns>
                    <Column width="120px">
                        <Text text="PR Number" />
                    </Column>
                    <Column width="80px">
                        <Text text="Item" />
                    </Column>
                    <Column width="200px">
                        <Text text="Material" />
                    </Column>
                    <Column width="100px">
                        <Text text="Plant" />
                    </Column>
                    <Column width="120px">
                        <Text text="Quantity" />
                    </Column>
                    <Column width="100px">
                        <Text text="Unit" />
                    </Column>
                    <Column width="120px">
                        <Text text="Delivery Date" />
                    </Column>
                    <Column width="120px">
                        <Text text="Status" />
                    </Column>
                    <Column width="120px">
                        <Text text="Requisitioner" />
                    </Column>
                    <Column width="120px">
                        <Text text="Created At" />
                    </Column>
                    <Column width="100px">
                        <Text text="Actions" />
                    </Column>
                </columns>

                <items>
                    <ColumnListItem press="onItemPress" type="Navigation">
                        <cells>
                            <ObjectIdentifier title="{PurchaseRequisition}" />
                            <Text text="{PurchaseReqnItem}" />
                            <VBox>
                                <Text text="{Material}" />
                                <Text text="{toMaterial/MaterialDescription/MaterialDescription}" class="sapUiContentPadding" />
                            </VBox>
                            <Text text="{Plant}" />
                            <ObjectNumber number="{
                                path: 'Quantity',
                                type: 'sap.ui.model.odata.type.Decimal',
                                formatOptions: { minFractionDigits: 2, maxFractionDigits: 3 }
                            }" />
                            <Text text="{BaseUnit}" />
                            <Text text="{
                                path: 'DeliveryDate',
                                type: 'sap.ui.model.odata.type.Date'
                            }" />
                            <ObjectStatus text="{ReleaseStatus}" 
                                         state="{
                                            path: 'ReleaseStatus',
                                            formatter: '.formatStatus'
                                         }" />
                            <Text text="{Requisitioner}" />
                            <Text text="{
                                path: 'createdAt',
                                formatter: '.formatDateTime'
                            }" />
                            <HBox>
                                <Button icon="sap-icon://edit" press="onEdit" type="Transparent" tooltip="Edit" />
                                <Button icon="sap-icon://delete" press="onDelete" type="Transparent" tooltip="Delete" />
                            </HBox>
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>
        </content>
    </Page>
</mvc:View>